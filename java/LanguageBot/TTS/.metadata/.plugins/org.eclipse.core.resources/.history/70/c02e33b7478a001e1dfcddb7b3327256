package port;

import java.util.Scanner;

import javax.sound.sampled.AudioFormat;
import javax.sound.sampled.AudioSystem;
import javax.sound.sampled.DataLine;
import javax.sound.sampled.SourceDataLine;

public class Main {
	public static boolean debug = false;
	public static int audioQuality = 9001;//33409 is the highest you can go without issue
	public static float audioQualityStep = 1102500 / audioQuality;
	static byte[] opBuffer;

	public static void main(String[] args) {
		// System.out.println(hi + off);
		// System.out.println(SamData.signInputTable1.length);
		boolean phonetic = true;
		int[] input = new int[257];
		if (!phonetic) {
			Scanner scnr = new Scanner(System.in);
			System.out.println("Enter the string you want spoken: ");
			String text = scnr.nextLine();
			scnr.close();
			for (int i = 0; i < text.length(); i++) {
				if (i >= 255)
					break;
				input[i] = text.toUpperCase().charAt(i);
			}
			
		} else {
		// Reciter.textToPhonemes(input);
		// input = globalInput;
		// putBumperOn(input);
			input = getPreMadeThing();
		}
		if (debug) {
			if (phonetic)
				System.out.println("phonetic input: \n" + getLetters(input));
			else
				System.out.printf("text input: %s\n", getLetters(input));
		}
		if (!phonetic) {
			String text;
			input[256] = '[';
			if ((text = Phonemes.textToPhonemes(getLetters(input))) == "") {
				System.out.println("oh no, reciter failed");
			}
			input = lmao(text);
			if (debug) {
				System.out.printf("phonetic input: %s\n", getLetters(input));
			}
		} else
			input[256] = '\0';
		// u009B

		Sam.SetInput(input);
		if (Sam.SAMMain() == 0) {
			PrintUsage();
			return;
		}
		// SeeIfItAcutallyPutSomethingIntoTheSoundBuffer();
		OutputSound();
		// writeToFile(Sam.buffer);
		// write the bloody thing into a file:

	}

	private static void SeeIfItAcutallyPutSomethingIntoTheSoundBuffer() {
		int zeros = 0;
		for (int i = 0; i < Sam.buffer.length; i++) {
			if (Sam.buffer[i] == 0) {
				zeros += 1;
			}
		}
		System.out.println(zeros);
	}

	static int pos = 0;

	public static void OutputSound() {
		opBuffer = new byte[Sam.bufferpos];
		for (int i = 0; i < Sam.bufferpos - 1; i++) {
			try {
				opBuffer[i] = (byte) Sam.buffer[i];
			} catch (Exception e) {
			}
		}

		try {
			AudioFormat audioFormat = new AudioFormat(audioQuality, 8, 1, true, false);
			DataLine.Info info = new DataLine.Info(SourceDataLine.class, audioFormat);
			SourceDataLine line = (SourceDataLine) AudioSystem.getLine(info);

			System.out.println("Playing...");
			line.open(audioFormat);
			line.start();

			line.write(opBuffer, 0, Sam.buffer.length);

			line.drain();
			line.close();
			System.out.println("Done playing!");
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	public static byte[] intArrayToByteArray(int[] intArray) {
		byte[] byteArray = new byte[intArray.length]; // Each int is 4 bytes (32 bits)

		for (int i = 0; i < intArray.length; i++) {
			byteArray[i] = (byte) intArray[i];
		}

		return byteArray;
	}

	public static int[] getPreMadeThing() {
		Sam.speed = 72;
		Sam.pitch = 64;
		//String injection = "/HEH2LOW1, /HAW AH YUX2 TUXDEY. AY /HOH3P YUX AH FIYLIHNX OW4 KEY. ";// I am a talking computah. go ahead punk. make my day.
		//String injection = "EYAYOYAWOWUW ULUMUNQ YXWXRXLX/XDX";
		String injection = "AY5 AEM EY TAO4LXKIHNX KAX4MPYUX4TAH. GOW4 AH/HEH3D PAHNK.MEYK MAY7 DEY.";
		// Sam.pitch = 100;
		//String injection = "/HEHLOW? IHS EHNIY BAODIY THEHER? AY NIYD TUX GAXW NAE8WW";
		// String injection = "/HEHLOW8W3W4W5W6W7, AY7 AEMM EY7IY8 TAO5LXKIHNX
		// KAX4MPYUX7TAH5. AY /HOH3P YUX AH FIYLIHNX OW4 KEY TUXDEY.";
		//String injection = " WAHV GOHS  W8 W7 W6 W5 W4 W3 W2 W1 W1 W2 W3 W4 W5 W6 W7 W8 W8 W7 W6 W5 W4 W3 W2 W1 W1 W2 W3 W4 W5 W6 W7 W8 W8 W7 W6 W5 W4 W3 W2 W1 W1 W2 W3 W4 W5 W6 W7 W8 W8";
		// String injection = "IHIHWWIHW5W1";
		char en1 = '\u009B';
		char en2 = '\0';
		int[] result = new int[257];
		for (int i = 0; i < injection.length(); i++) {
			result[i] = injection.charAt(i);
		}
		result[injection.length() + 0] = en1;
		result[injection.length() + 1] = en2;
		return result;
	}
	
	public static int[] lmao(String injection) {
		char en1 = '\u009B';
		char en2 = '\0';
		int[] result = new int[257];
		for (int i = 0; i < injection.length(); i++) {
			result[i] = injection.charAt(i);
		}
		result[injection.length() + 0] = en1;
		result[injection.length() + 1] = en2;
		return result;
	}

	public static String getLetters(int[] text) {
		String result = "";
		for (int i = 0; i < text.length; i++) {
			result += (char) text[i];
		}
		return result;
	}

	public static void printList(int[] in) {
		for (int i = 0; i < in.length; i++) {
			System.out.print(" " + in[i]);
		}
	}

	public static void PrintUsage() {
		System.out.print("usage: sam [options] Word1 Word2 ....\n");
		System.out.printf("options\n");
		System.out.printf("	-phonetic 		enters phonetic mode. (see below)\n");
		System.out.printf("	-pitch number		set pitch value (default=64)\n");
		System.out.printf("	-speed number		set speed value (default=72)\n");
		System.out.printf("	-throat number		set throat value (default=128)\n");
		System.out.printf("	-mouth number		set mouth value (default=128)\n");
		System.out.printf("	-wav filename		output to wav instead of libsdl\n");
		System.out.printf("	-sing			special treatment of pitch\n");
		System.out.printf("	-debug			print additional debug messages\n");
		System.out.printf("\n");

		System.out.printf("     VOWELS                            VOICED CONSONANTS	\n");
		System.out.printf("IY           f(ee)t                    R        red		\n");
		System.out.printf("IH           p(i)n                     L        allow		\n");
		System.out.printf("EH           beg                       W        away		\n");
		System.out.printf("AE           Sam                       W        whale		\n");
		System.out.printf("AA           pot                       Y        you		\n");
		System.out.printf("AH           b(u)dget                  M        Sam		\n");
		System.out.printf("AO           t(al)k                    N        man		\n");
		System.out.printf("OH           cone                      NX       so(ng)		\n");
		System.out.printf("UH           book                      B        bad		\n");
		System.out.printf("UX           l(oo)t                    D        dog		\n");
		System.out.printf("ER           bird                      G        again		\n");
		System.out.printf("AX           gall(o)n                  J        judge		\n");
		System.out.printf("IX           dig(i)t                   Z        zoo		\n");
		System.out.printf("				       					  ZH       plea(s)ure	\n");
		System.out.printf("   DIPHTHONGS                          V        seven		\n");
		System.out.printf("EY           m(a)de                    DH       (th)en		\n");
		System.out.printf("AY           h(igh)						\n");
		System.out.printf("OY           boy						\n");
		System.out.printf("AW           h(ow)                     UNVOICED CONSONANTS	\n");
		System.out.printf("OW           slow                      S         Sam		\n");
		System.out.printf("UW           crew                      Sh        fish		\n");
		System.out.printf("                                       F         fish		\n");
		System.out.printf("                                       TH        thin		\n");
		System.out.printf(" SPECIAL PHONEMES                      P         poke		\n");
		System.out.printf("UL           sett(le) (=AXL)           T         talk		\n");
		System.out.printf("UM           astron(omy) (=AXM)        K         cake		\n");
		System.out.printf("UN           functi(on) (=AXN)         CH        speech		\n");
		System.out.printf("Q            kitt-en (glottal stop)    /H        a(h)ead	\n");
	}
}
